import{a as pe,r as _,e as ve,N as me,h as g,o as s,c as C,k as r,j as c,y as l,x as N,A as D,i as u,F as k,l as m,s as O,u as fe,_ as he,C as ye,D as ge,m as Ce,G as ke}from"./entry.b3d0478f.js";import{_ as Ee}from"./ossUploaderNew.bc250fbe.js";import{_ as Le}from"./svga.4b61c129.js";import{_ as Te}from"./addBase.6bac7936.js";import{_ as Ie}from"./close.79d7cbfd.js";import{c as Ne}from"./curriculum.943a89fc.js";import{_ as Oe}from"./robot.23bfda18.js";import{_ as Ve}from"./unit.b72b5b5d.js";import{l as we}from"./loding.3cd02d06.js";const E=U=>(ye("data-v-13fbc39b"),U=U(),ge(),U),Pe={class:"header"},Ae=E(()=>l("div",null,"编辑",-1)),Ue={class:"cCreate-content"},be={class:"content-top"},Me=["src"],xe={class:"top-name"},De={class:"name"},Se={class:"remark"},Fe={class:"content-main"},Re={key:0,class:"form-item"},$e=E(()=>l("div",{class:"example",style:{padding:"0"}},"不知道写什么?",-1)),Be={class:"form-item-title"},Ge={class:"name"},Je={key:0,class:"require"},qe={key:1,class:"addType"},Ke={key:0,class:"content-upload"},Xe={class:"upload"},We={class:"upload-area"},He={key:0,class:"area-file"},ze=E(()=>l("img",{src:Ne},null,-1)),je=[ze],Qe=E(()=>l("div",null,"请上传文件，支持 PDF、Word 格式",-1)),Ye={key:1,class:"dataList"},Ze={class:"input"},ea=E(()=>l("div",{class:"input-title"},"题数",-1)),aa={class:"input"},oa=E(()=>l("div",{class:"input-title"},"总分值",-1)),ta={class:"reduce"},la={class:"knowledge-list"},sa={class:"knowledge-item"},na={class:"item-logo"},da=["src"],ua={key:1,src:Oe,alt:""},ca={class:"item-name"},ra={key:1,class:"loading-data"},ia={class:"footer"},_a={class:"footer-title"},pa=E(()=>l("img",{src:Ve},null,-1)),va=E(()=>l("div",{class:"title1"},"共消耗",-1)),ma={class:"title2"},fa=E(()=>l("div",{class:"title3"},"电量",-1)),ha={class:"footer-btn"},ya=pe({__name:"cCreate",emits:["ok","cancel"],setup(U,{expose:H,emit:F}){const R=_(""),z=ve(),V=_(""),w=_(!1),$=_(),{proxy:h}=Ce(),L=_(!1),B=_(""),j=_([]),G=_(),P=_(!0),i=_([]),T=_(),b=_(null),p=_([]),J=_(null),Q=_([{value:"radio",name:"单选题"},{value:"checkbox",name:"多选题"},{value:"gap",name:"填空题"},{value:"judgment",name:"判断题"},{value:"shortAnswer",name:"简答题"},{value:"calculation",name:"计算题"},{value:"essayQuestion",name:"论述题"},{value:"experimental ",name:"实验题"},{value:"essayTitle",name:"作文题"},{value:"graphQuestion",name:"图表题"},{value:"lineMatching",name:"连线匹配题"},{value:"translation",name:"翻译题"},{value:"reading",name:"阅读理解题"}]),Y=o=>{clearInterval(b.value),p.value=[],w.value=!0,L.value=!0,T.value={},h.$api.space_robotGetRobotInfo({code:o}).then(e=>{T.value=e.data,$.value=e.data.consumeEnergy,V.value=e.data.code,B.value=e.data.type;let d=e.data.questionBank;h.$isEmpty(JSON.parse(d).example)||(j.value=JSON.parse(d).example.split(",")),P.value=!0,i.value=JSON.parse(d).columnPageItemList,i.value.length==1&&(h.$isEmpty(i.value[0].example)?P.value=!1:P.value=!0),i.value.map(a=>({...a,value:""})),i.value.forEach((a,f)=>{if(a.formType=="SELECT"||a.formType=="TABS"||a.formType=="RADIO"){let I="",A=a.attrItemJson.split(";");A.forEach((M,x)=>{x==0?I=M.split("||")[0]:I=I+";"+M.split("||")[0],x==Number(A.length-1)&&(a.attrItemJson=I,a.value=a.attrItemJson.split(";")[0])})}a.formType=="UPLOAD_FILE"&&(a.value="",P.value=!1),a.formType=="KNOWLEDGE_COMPONENT"&&(a.value="",a.knowledgeCodeList=[]),a.formType=="UPLOAD_IMAGE"&&(a.value="",a.attachmentFileCodeList=[]),f==Number(i.value.length-1)&&Z()}),oe(),L.value=!1}).catch(()=>{L.value=!1})},Z=()=>{h.$api.getQuestionBankRobotHistory({robotCode:V.value}).then(o=>{o.data&&o.data.dataMap&&i.value.forEach(e=>{e.value=o.data.dataMap[e.itemParam],e.formType=="UPLOAD_FILE"&&(e.value=""),e.formType=="KNOWLEDGE_COMPONENT"&&(e.value=""),e.formType=="UPLOAD_IMAGE"&&(e.value="")})})},ee=()=>{i.value.forEach(o=>{o.value=o.example})},ae=o=>{o==1&&(F("cancel"),w.value=!1),o==2&&(F("ok"),w.value=!1)},oe=()=>{let o={type:B.value,robotCode:V.value};h.$api.ai_bulidChatGroupId(o).then(e=>{G.value=e.data})},te=()=>{if(L.value)return;let o={},e=!1;if(o.knowledgeCodeList=[],o.attachmentFileCodeList=[],i.value.forEach(a=>{o[a.itemParam]=a.value?a.value:"",a.hadRequired&&h.$isEmpty(a.value)&&!e&&a.formType!="EXAMINATION_COMPONENT"&&a.formType!="KNOWLEDGE_COMPONENT"&&a.formType!="UPLOAD_IMAGE"&&(h.$Message.error("请"+(a.formType=="SELECT"?"选择":"输入")+a.itemName),e=!0),a.formType=="EXAMINATION_COMPONENT"&&a.hadRequired&&p.value.length==0&&(h.$Message.error("请选择"+a.itemName),e=!0),p.value.length!=0&&i.value.forEach(f=>{f.formType=="EXAMINATION_COMPONENT"&&(o[f.itemParam]=p.value)}),a.formType=="DATE"&&(o[a.itemParam]=h.$dateFormat(a.value,"yyyy-MM-dd")),a.formType=="KNOWLEDGE_COMPONENT"&&(o[a.itemParam]=a.knowledgeCodeList,o.knowledgeCodeList=o.knowledgeCodeList.concat(a.knowledgeCodeList),a.hadRequired&&o.knowledgeCodeList.length==0&&(h.$Message.error("请选择"+a.itemName),e=!0)),a.formType=="UPLOAD_IMAGE"&&(o.attachmentFileCodeList=o.attachmentFileCodeList.concat(a.attachmentFileCodeList),a.hadRequired&&o.attachmentFileCodeList.length==0&&(h.$Message.error("请选择"+a.itemName),e=!0))}),e)return;let d={content:o,groupId:G.value,robotCode:V.value,requestContent:o,sseStream:!0,attachmentFileCodeList:o.attachmentFileCodeList?o.attachmentFileCodeList:[],knowledgeCodeList:o.knowledgeCodeList?o.knowledgeCodeList:[]};d.content&&d.content.attachmentFileCodeList&&delete d.content.attachmentFileCodeList,d.content&&d.content.knowledgeCodeList&&delete d.content.knowledgeCodeList,L.value=!0,localStorage.removeItem("createHis"),setTimeout(()=>{localStorage.setItem("createHis",JSON.stringify(d)),b.value=setInterval(()=>{localStorage.getItem("createHis")&&(clearInterval(b.value),L.value=!1,z.push("/ai/creative/detail?robotCode="+V.value))},100)},100)},S=(o,e)=>{o=="add"&&p.value.push({type:"radio",num:1,score:1}),o=="reduce"&&p.value.splice(e,1)},le=o=>{R.value=o.itemParam,J.value.showFn()},se=o=>{i.value.forEach(e=>{e.itemParam==R.value&&(e.knowledgeCodeList=[],e.knowledgeList=[],o.forEach(d=>{e.knowledgeCodeList.push(d.code),e.knowledgeList.push(d)}))})},ne=(o,e)=>{i.value.forEach(d=>{d.itemParam==o.itemParam&&(d.knowledgeCodeList.splice(e,1),d.knowledgeList.splice(e,1))})};me(()=>{clearInterval(b.value)});const de=(o,e)=>{i.value[o].value=e[0].code},ue=(o,e)=>{i.value.forEach(d=>{d.itemParam==o.itemParam&&(d.attachmentFileCodeList=[],d.attachmentFileCodeList.push(e[0].code))})};return H({showFn:Y}),(o,e)=>{const d=g("Icon"),a=g("Input"),f=he,I=g("Option"),A=g("Select"),M=g("DatePicker"),x=g("Radio"),ce=g("RadioGroup"),q=Ee,K=g("InputNumber"),X=g("Button"),re=Le,ie=g("Modal"),_e=Te;return s(),C(f,null,{default:r(()=>[c(ie,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),width:"680","mask-closable":!1,"class-name":"cCreate",closable:!1,transfer:!0},{header:r(()=>[l("div",Pe,[Ae,l("img",{src:Ie,onClick:e[0]||(e[0]=t=>ae(1))})])]),footer:r(()=>[l("div",ia,[l("div",_a,[pa,va,l("div",ma,N($.value),1),fa]),l("div",ha,[c(X,{type:"primary",class:"btn",loading:L.value,onClick:te},{default:r(()=>[D("立即生成")]),_:1},8,["loading"])])])]),default:r(()=>[l("div",Ue,[L.value?(s(),u("div",ra,[c(re,{svgaImg:fe(we),canvasName:"loading",width:120},null,8,["svgaImg"])])):(s(),u(k,{key:0},[T.value&&T.value.code?(s(),u(k,{key:0},[l("div",be,[l("img",{src:T.value.robotLogo},null,8,Me),l("div",xe,[l("div",De,N(T.value.name),1),l("div",Se,N(T.value.robotRemark),1)])]),l("div",Fe,[P.value?(s(),u("div",Re,[l("div",{class:"form-item-title"},[$e,l("div",{class:"href",onClick:ee},"试试示例")])])):m("",!0),(s(!0),u(k,null,O(i.value,(t,W)=>(s(),u("div",{class:"form-item",key:W},[l("div",Be,[l("div",Ge,N(t.itemName),1),t.hadRequired?(s(),u("div",Je,"*")):m("",!0),t.formType=="EXAMINATION_COMPONENT"?(s(),u("div",qe,[c(d,{class:"addBtn",type:"ios-add-circle-outline",size:"24",onClick:e[1]||(e[1]=n=>S("add"))}),l("div",{class:"name",onClick:e[2]||(e[2]=n=>S("add"))},"添加题目类型")])):m("",!0)]),t.formType=="TEXT"?(s(),C(a,{key:0,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,placeholder:t.attrItemJson},null,8,["modelValue","onUpdate:modelValue","placeholder"])):m("",!0),c(f,null,{default:r(()=>[t.formType=="TEXTAREA"?(s(),C(a,{key:0,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,type:"textarea",placeholder:t.attrItemJson,rows:6},null,8,["modelValue","onUpdate:modelValue","placeholder"])):m("",!0)]),_:2},1024),t.formType=="SELECT"||t.formType=="TABS"?(s(),C(A,{key:1,transfer:!0,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,style:{"max-width":"50%"}},{default:r(()=>[(s(!0),u(k,null,O(t.attrItemJson.split(";"),(n,v)=>(s(),C(I,{value:n,key:v},{default:r(()=>[D(N(n),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):m("",!0),c(f,null,{default:r(()=>[t.formType=="DATE"?(s(),C(M,{key:0,type:"date",modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,placeholder:t.attrItemJson},null,8,["modelValue","onUpdate:modelValue","placeholder"])):m("",!0)]),_:2},1024),c(f,null,{default:r(()=>[t.formType=="RADIO"?(s(),C(ce,{key:0,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n},{default:r(()=>[(s(!0),u(k,null,O(t.attrItemJson.split(";"),(n,v)=>(s(),C(x,{value:n,label:n},null,8,["value","label"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])):m("",!0)]),_:2},1024),c(f,null,{default:r(()=>[t.formType=="UPLOAD_FILE"?(s(),u("div",Ke,[l("div",Xe,[c(q,{id:"cImage-upload",format:["pdf","doc","docx"],modeType:"freedom",onUploadSuccess:n=>de(W,n)},{content:r(()=>[l("div",We,[t.value?(s(),u("div",He,je)):(s(),u(k,{key:1},[c(d,{type:"ios-cloud-upload",size:"40"}),Qe],64))])]),_:2},1032,["onUploadSuccess"])])])):m("",!0),t.formType=="EXAMINATION_COMPONENT"?(s(),u("div",Ye,[(s(!0),u(k,null,O(p.value,(n,v)=>(s(),u("div",{class:"dataList-item",key:v},[c(A,{class:"select",modelValue:p.value[v].type,"onUpdate:modelValue":y=>p.value[v].type=y},{default:r(()=>[(s(!0),u(k,null,O(Q.value,y=>(s(),C(I,{value:y.value},{default:r(()=>[D(N(y.name),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l("div",Ze,[ea,c(K,{min:1,modelValue:p.value[v].num,"onUpdate:modelValue":y=>p.value[v].num=y},null,8,["modelValue","onUpdate:modelValue"])]),l("div",aa,[oa,c(K,{min:1,modelValue:p.value[v].score,"onUpdate:modelValue":y=>p.value[v].score=y},null,8,["modelValue","onUpdate:modelValue"])]),l("div",ta,[c(d,{type:"ios-remove-circle-outline",size:"25",onClick:y=>S("reduce",v)},null,8,["onClick"])])]))),128))])):m("",!0)]),_:2},1024),c(f,null,{default:r(()=>[t.formType=="KNOWLEDGE_COMPONENT"?(s(),u(k,{key:0},[c(X,{onClick:n=>le(t)},{default:r(()=>[D("选择知识库")]),_:2},1032,["onClick"]),l("div",la,[(s(!0),u(k,null,O(t.knowledgeList,(n,v)=>(s(),u("div",sa,[l("div",na,[n.avatar?(s(),u("img",{key:0,src:n.avatar},null,8,da)):(s(),u("img",ua))]),l("div",ca,N(n.name),1),c(d,{type:"md-close-circle",size:"15",onClick:y=>ne(t,v),class:"item-close"},null,8,["onClick"])]))),256))])],64)):m("",!0)]),_:2},1024),c(f,null,{default:r(()=>[t.formType=="UPLOAD_IMAGE"?(s(),C(q,{key:0,url:t.value,"onUpdate:url":n=>t.value=n,format:["jpg","jpeg","gif","png","bmp","webp"],limit:30,multiple:!0,onUploadSuccess:n=>ue(t,n)},null,8,["url","onUpdate:url","onUploadSuccess"])):m("",!0)]),_:2},1024)]))),128))])],64)):m("",!0)],64))])]),_:1},8,["modelValue"]),c(_e,{ref_key:"addBaseRef",ref:J,onInit:se},null,512)]),_:1})}}});const Va=ke(ya,[["__scopeId","data-v-13fbc39b"]]);export{Va as _};
